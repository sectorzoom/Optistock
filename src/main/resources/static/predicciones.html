<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>üß† Predicciones de compra</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .recomendacion-box {
      padding: 1rem;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-5">
  <h2 class="mb-4">üß† Predicciones de Compra</h2>

  <div id="contenedor-recomendaciones"></div>
</div>

<script>
  const productos = [];
  const token = ""; // <- Est√° vac√≠o a prop√≥sito porque no lo estamos usando

  async function cargarProductos() {
    try {
      const res = await fetch("/api/productos");
      const data = await res.json();
      productos.push(...data);
      mostrarRecomendaciones();
    } catch (e) {
      document.getElementById("contenedor-recomendaciones").innerHTML = "‚ùå Error cargando productos";
    }
  }

  async function mostrarRecomendaciones() {
    const contenedor = document.getElementById("contenedor-recomendaciones");
    contenedor.innerHTML = "";

    for (const producto of productos) {
      const div = document.createElement("div");
      div.id = `recomendacion-${producto.id}`;
      div.innerHTML = `<div class="text-muted">‚åõ Cargando recomendaci√≥n para <b>${producto.nombre}</b>...</div>`;
      contenedor.appendChild(div);

      try {
        const res = await fetch(`/api/recomendacion/${producto.id}`);
        const data = await res.json();

        if (data.error) {
          div.innerHTML = `<div class="alert alert-warning">‚ö†Ô∏è ${data.error}</div>`;
        } else {
          let color;
          const dias = data.dias_estimados_para_agotar_stock;
          if (dias <= 1) color = '#ffe5e5';
          else if (dias <= 3) color = '#fff3cd';
          else color = '#e6ffed';

          div.innerHTML = `
            <div class="recomendacion-box" style="background-color: ${color};">
              <h5>${data.producto}</h5>
              <p><b>Stock actual:</b> ${data.stock_actual}</p>
              <p><b>Consumo diario estimado:</b> ${data.consumo_diario_estimado}</p>
              <p><b>Fecha recomendada:</b> ${data.fecha_recomendada}</p>
              <p><b>D√≠as estimados para agotar:</b> ${dias}</p>
              <p><b>‚úÖ Recomendaci√≥n:</b> ${data.recomendacion}</p>
            </div>
          `;
        }

      } catch (e) {
        div.innerHTML = `<div class="alert alert-danger">‚ùå Error al consultar la IA</div>`;
      }
    }
  }

  cargarProductos();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
